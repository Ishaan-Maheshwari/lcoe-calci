<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar LCOE Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚òÄÔ∏è Solar LCOE Calculator</h1>
            <p>Levelized Cost of Energy Analysis for Solar Power Projects</p>
        </header>

        <div class="content">
            <!-- LEFT PANEL: INPUTS -->
            <div class="panel">
                <h2>üìä Input Parameters</h2>

                <!-- Project Capacity -->
                <div class="input-group">
                    <label>
                        Installed Capacity (MW)
                        <span class="tooltip-icon" data-tooltip="Total installed MW capacity">?</span>
                    </label>
                    <input type="number" id="capacity" value="1.0" step="0.1" min="0.01">
                </div>

                <!-- Annual Energy Generation -->
                <div class="input-group">
                    <label>
                        Annual Energy Generation (MWh)
                        <span class="tooltip-icon" data-tooltip="Expected annual energy output">?</span>
                    </label>
                    <input type="number" id="energy_generation" value="1700" step="10" min="0">
                </div>

                <div class="section-divider"></div>

                <!-- CAPEX -->
                <div class="input-group">
                    <label>
                        CAPEX per MW (‚Çπ)
                        <span class="tooltip-icon" data-tooltip="Capital cost per MW">?</span>
                    </label>
                    <input type="number" id="capex_per_mw" value="50000000" step="1000000" min="0">
                </div>

                <!-- OPEX Percentage -->
                <div class="input-group">
                    <label>
                        Annual OPEX (% of CAPEX)
                        <span class="tooltip-icon" data-tooltip="Operation & Maintenance as % of total CAPEX">?</span>
                    </label>
                    <input type="number" id="opex_percent" value="2.0" step="0.1" min="0">
                </div>

                <!-- Auto-calculated OPEX -->
                <div class="input-group">
                    <label>
                        Calculated Annual OPEX (‚Çπ)
                        <span class="tooltip-icon" data-tooltip="Auto-calculated from CAPEX √ó OPEX%">?</span>
                    </label>
                    <input type="text" id="opex_calculated" readonly class="auto-calc">
                </div>

                <div class="section-divider"></div>

                <!-- Loan Details -->
                <div class="input-group">
                    <label>
                        Loan Interest Rate (%)
                        <span class="tooltip-icon" data-tooltip="Annual interest rate on debt">?</span>
                    </label>
                    <input type="number" id="interest_rate" value="10.0" step="0.1" min="0">
                </div>

                <div class="input-group">
                    <label>
                        Loan Tenure (Years)
                        <span class="tooltip-icon" data-tooltip="Years to repay the loan">?</span>
                    </label>
                    <input type="number" id="loan_tenure" value="10" step="1" min="1">
                </div>

                <!-- Auto-calculated EMI -->
                <div class="input-group">
                    <label>
                        Annual EMI (‚Çπ)
                        <span class="tooltip-icon" data-tooltip="Auto-calculated annual loan repayment">?</span>
                    </label>
                    <input type="text" id="emi_calculated" readonly class="auto-calc">
                </div>

                <div class="section-divider"></div>

                <!-- Project Lifetime -->
                <div class="input-group">
                    <label>
                        Project Lifetime (Years)
                        <span class="tooltip-icon" data-tooltip="Total analysis period">?</span>
                    </label>
                    <input type="number" id="project_lifetime" value="25" step="1" min="1">
                </div>

                <!-- Discount Rate -->
                <div class="input-group">
                    <label>
                        Discount Rate (%)
                        <span class="tooltip-icon" data-tooltip="Rate for NPV calculation">?</span>
                    </label>
                    <input type="number" id="discount_rate" value="8.0" step="0.1" min="0" max="50">
                </div>

                <!-- CUE -->
                <div class="input-group">
                    <label>
                        Capacity Utilization Efficiency
                        <span class="tooltip-icon" data-tooltip="Annual energy / (Capacity √ó 8760 hours)">?</span>
                    </label>
                    <input type="text" id="cue_calculated" readonly class="auto-calc">
                </div>

                <div class="info-box">
                    üí° All values auto-update when inputs change. Yellow fields are calculated automatically.
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="UI.resetForm()">üîÑ Reset</button>
                    <button class="btn-primary" onclick="UI.downloadCSV()">üì• Export CSV</button>
                </div>
            </div>

            <!-- RIGHT PANEL: RESULTS -->
            <div class="panel">
                <h2>üìà Results</h2>

                <!-- Main LCOE Results -->
                <div class="result-card">
                    <h3>LCOE (per MWh)</h3>
                    <div class="value" id="lcoe_mwh">‚Çπ0.00</div>
                    <div class="unit">Levelized Cost per MWh</div>
                </div>

                <div class="result-card">
                    <h3>LCOE (per kWh)</h3>
                    <div class="value" id="lcoe_kwh">‚Çπ0.00</div>
                    <div class="unit">Levelized Cost per kWh</div>
                </div>

                <!-- Breakdown Table -->
                <h3 style="color: #333; margin-top: 20px;">Detailed Breakdown</h3>
                <table class="breakdown-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="label">Total CAPEX (‚Çπ)</td>
                            <td class="value" id="breakdown-capex">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">Total O&M Cost (‚Çπ)</td>
                            <td class="value" id="breakdown-om">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">Total Loan Repayment (‚Çπ)</td>
                            <td class="value" id="breakdown-loan">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">NPV of OPEX (‚Çπ)</td>
                            <td class="value" id="breakdown-npv">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">Total Energy Generated (MWh)</td>
                            <td class="value" id="breakdown-energy">0.00</td>
                        </tr>
                        <tr style="background: #f0f0f0; font-weight: bold;">
                            <td class="label">Capacity Utilization (%) </td>
                            <td class="value" id="breakdown-cue-percent">0.00</td>
                        </tr>
                    </tbody>
                </table>

                <div class="info-box" style="margin-top: 20px;">
                    üìù <strong>Formula Used:</strong> LCOE = (CAPEX + NPV of OPEX) / Total Energy Generated
                </div>
            </div>
        </div>

        <!-- ADVANCED CHARTS SECTION -->
        <div class="charts-section">
            <h2 style="text-align: center; color: #333; margin-bottom: 30px;">üîç Advanced Sensitivity Analysis</h2>

            <!-- TORNADO DIAGRAM -->
            <div class="chart-container-full">
                <h3 style="color: #333; margin-bottom: 15px;">üå™Ô∏è Tornado Diagram: Which Parameters Matter Most?</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">
                    Shows how ¬±% change in each parameter affects LCOE. <strong>Wider bars = More impact</strong>. Ranked by sensitivity.
                </p>
                <div class="tornado-controls" style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                    <label>Variance (¬±%):</label>
                    <input type="number" id="tornado-variance" value="20" min="5" max="50" step="5" style="width: 80px;">
                    <button class="btn-primary" onclick="UI.updateTornadoChart()" style="width: auto; padding: 8px 16px;">Update</button>
                </div>
                <canvas id="chart-tornado" style="min-height: 400px;"></canvas>
            </div>

            <!-- DUAL PARAMETER HEATMAP -->
            <div class="chart-container-full" style="margin-top: 40px;">
                <h3 style="color: #333; margin-bottom: 15px;">üî• Dual Parameter Heatmap: Interactive Sensitivity</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">
                    Explore LCOE across two parameters simultaneously. <strong>Green = Low LCOE (better)</strong>, <strong>Red = High LCOE (worse)</strong>.
                </p>

                <div class="heatmap-controls">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="input-group">
                            <label>First Parameter:</label>
                            <select id="heatmap-param1" onchange="UI.updateHeatmap()">
                                <option value="capex_per_mw">CAPEX per MW (‚Çπ)</option>
                                <option value="energy_generation">Annual Energy (MWh)</option>
                                <option value="discount_rate">Discount Rate (%)</option>
                                <option value="opex_percent">OPEX % of CAPEX</option>
                                <option value="interest_rate">Interest Rate (%)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Second Parameter:</label>
                            <select id="heatmap-param2" onchange="UI.updateHeatmap()">
                                <option value="discount_rate">Discount Rate (%)</option>
                                <option value="capex_per_mw">CAPEX per MW (‚Çπ)</option>
                                <option value="energy_generation">Annual Energy (MWh)</option>
                                <option value="opex_percent">OPEX % of CAPEX</option>
                                <option value="interest_rate">Interest Rate (%)</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-primary" onclick="UI.updateHeatmap()" style="width: 100%; margin-bottom: 15px;">Generate Heatmap</button>
                </div>

                <div class="heatmap-chart-container">
                    <canvas id="chart-heatmap" style="min-height: 400px; margin-bottom: 20px;"></canvas>
                </div>

                <!-- Heatmap Table -->
                <div id="heatmap-table-container" style="margin-top: 20px; overflow-x: auto;"></div>
            </div>

            <!-- PARAMETER RANGE ANALYSIS -->
            <div class="chart-container-full" style="margin-top: 40px;">
                <h3 style="color: #333; margin-bottom: 15px;">üìä Parameter Range Analysis</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">
                    See how LCOE changes across realistic parameter ranges. Understand the full sensitivity spectrum.
                </p>

                <!-- Combined Parameters Chart -->
                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <canvas id="chart-parameters-combo" style="min-height: 350px;"></canvas>
                </div>

                <!-- Individual Parameter Charts -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-bottom: 30px;">
                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <canvas id="chart-capex-range" style="min-height: 300px;"></canvas>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <canvas id="chart-energy-range" style="min-height: 300px;"></canvas>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <canvas id="chart-discount-range" style="min-height: 300px;"></canvas>
                    </div>
                </div>

                <!-- Range Summary Table -->
                <h4 style="color: #333; margin-bottom: 15px;">üìã Range Summary Table</h4>
                <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">
                    Quick reference showing LCOE at minimum, current, and maximum for each parameter.
                </p>
                <div id="range-summary-container" style="overflow-x: auto; background: white; padding: 20px; border-radius: 8px;"></div>
            </div>
        </div>
    </div>

    <script src="calculator.js"></script>
    <script src="advanced-charts.js"></script>
    <script src="range-charts.js"></script>
    <script src="ui.js"></script>
</body>
</html>