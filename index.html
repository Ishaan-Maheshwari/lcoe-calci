<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar LCOE Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚òÄÔ∏è Solar LCOE Calculator</h1>
            <p>Levelized Cost of Energy Analysis for Solar Power Projects</p>
        </header>

        <div class="content">
            <!-- LEFT PANEL: INPUTS -->
            <div class="panel">
                <h2>üìä Input Parameters</h2>

                <!-- Project Capacity -->
                <div class="input-group">
                    <label>
                        Installed Capacity (MW)
                        <span class="tooltip-icon" data-tooltip="Total installed MW capacity">?</span>
                    </label>
                    <input type="number" id="capacity" value="1.0" step="0.1" min="0.01">
                </div>

                <!-- Annual Energy Generation -->
                <div class="input-group">
                    <label>
                        Total Energy Generated (MWh)
                        <span class="tooltip-icon" data-tooltip="Expected annual energy output">?</span>
                    </label>
                    <input type="number" id="energy_generation" value="1627.53" step="10" min="0">
                </div>

                <div class="section-divider"></div>

                <!-- CAPEX -->
                <div class="input-group">
                    <label>
                        Total CAPEX (‚Çπ)
                        <span class="tooltip-icon" data-tooltip="Total Capital cost">?</span>
                    </label>
                    <input type="number" id="capex_per_mw" value="34400000" step="1000000" min="0">
                </div>

                <!-- OPEX Percentage -->
                <div class="input-group">
                    <label>
                        Annual OPEX (% of CAPEX)
                        <span class="tooltip-icon" data-tooltip="Operation & Maintenance as % of total CAPEX">?</span>
                    </label>
                    <input type="number" id="opex_percent" value="1.0" step="0.1" min="0">
                </div>

                <!-- Auto-calculated OPEX -->
                <div class="input-group">
                    <label>
                        Calculated Annual OPEX (‚Çπ)
                        <span class="tooltip-icon" data-tooltip="Auto-calculated from CAPEX √ó OPEX%">?</span>
                    </label>
                    <input type="text" id="opex_calculated" readonly class="auto-calc">
                </div>

                <div class="section-divider"></div>

                <!-- Loan Details -->
                <div class="input-group">
                    <label>
                        Loan Interest Rate (%)
                        <span class="tooltip-icon" data-tooltip="Annual interest rate on debt">?</span>
                        <span style="font-size: 0.8em; color: #a09e80;">Put interest rate as 0 if no loan is applicable.</span>
                    </label>
                    <input type="number" id="interest_rate" value="8.25" step="0.1" min="0">
                </div>

                <div class="input-group">
                    <label>
                        Loan Tenure (Years)
                        <span class="tooltip-icon" data-tooltip="Years to repay the loan">?</span>
                    </label>
                    <input type="number" id="loan_tenure" value="20" step="1" min="1">
                </div>

                <!-- Auto-calculated EMI -->
                <div class="input-group">
                    <label>
                        Annual EMI (‚Çπ)
                        <span class="tooltip-icon" data-tooltip="Auto-calculated annual loan repayment">?</span>
                    </label>
                    <input type="text" id="emi_calculated" readonly class="auto-calc">
                </div>

                <div class="section-divider"></div>

                <!-- Project Lifetime -->
                <div class="input-group">
                    <label>
                        Project Lifetime (Years)
                        <span class="tooltip-icon" data-tooltip="Total analysis period">?</span>
                    </label>
                    <input type="number" id="project_lifetime" value="20" step="1" min="1">
                </div>

                <!-- Discount Rate -->
                <div class="input-group">
                    <label>
                        Discount Rate (%)
                        <span class="tooltip-icon" data-tooltip="Rate for NPV calculation">?</span>
                    </label>
                    <input type="number" id="discount_rate" value="9.0" step="0.1" min="0" max="50">
                </div>

                <!-- CUE -->
                <div class="input-group">
                    <label>
                        Capacity Utilization Efficiency
                        <span class="tooltip-icon" data-tooltip="Annual energy / (Capacity √ó 8760 hours)">?</span>
                    </label>
                    <input type="text" id="cue_calculated" readonly class="auto-calc">
                </div>

                <!-- <div class="info-box">
                    üí° All values auto-update when inputs change. Yellow fields are calculated automatically.
                </div> -->

                <div class="button-group">
                    <button class="btn-secondary" onclick="UI.resetForm()">üîÑ Reset</button>
                    <button class="btn-primary" onclick="UI.updateResults()">üìä Calculate LCOE</button>
                    <!-- <button class="btn-primary" onclick="UI.downloadCSV()">üì• Export CSV</button> -->
                </div>
            </div>

            <!-- RIGHT PANEL: RESULTS -->
            <div class="panel">
                <h2>üìà Results</h2>

                <!-- Main LCOE Results -->
                <div class="result-card">
                    <h3>LCOE (per MWh)</h3>
                    <div class="value" id="lcoe_mwh">‚Çπ0.00</div>
                    <div class="unit">Levelized Cost per MWh</div>
                </div>

                <div class="result-card">
                    <h3>LCOE (per kWh)</h3>
                    <div class="value" id="lcoe_kwh">‚Çπ0.00</div>
                    <div class="unit">Levelized Cost per kWh</div>
                </div>

                <!-- Breakdown Table -->
                <h3 style="color: #333; margin-top: 20px;">Detailed Breakdown</h3>
                <table class="breakdown-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="label">Total CAPEX (‚Çπ)</td>
                            <td class="value" id="breakdown-capex">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">Total O&M Cost (‚Çπ)</td>
                            <td class="value" id="breakdown-om">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">Total Loan Repayment (‚Çπ)</td>
                            <td class="value" id="breakdown-loan">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">Total OPEX (‚Çπ)</td>
                            <td class="value" id="breakdown-opex">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">NPV of OPEX (‚Çπ)</td>
                            <td class="value" id="breakdown-npv">0.00</td>
                        </tr>
                        <tr>
                            <td class="label">Total Energy Generated (MWh)</td>
                            <td class="value" id="breakdown-energy">0.00</td>
                        </tr>
                        <tr style="background: #f0f0f0; font-weight: bold;">
                            <td class="label">Capacity Utilization (%) </td>
                            <td class="value" id="breakdown-cue-percent">0.00</td>
                        </tr>
                    </tbody>
                </table>

                <div class="info-box" style="margin-top: 20px;">
                    üìù <strong>Formula Used:</strong> LCOE = (CAPEX + NPV of OPEX) / Total Energy Generated
                </div>
            </div>
        </div>

        <!-- TABBED ANALYSIS SECTION -->
        <div class="analysis-section">
            <h2 style="text-align: center; color: #333; margin-bottom: 20px;">üìà Charts & Analysis</h2>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="UI.switchTab('sensitivity')">
                    üå™Ô∏è Sensitivity Analysis
                </button>
                <button class="tab-btn" onclick="UI.switchTab('heatmap')">
                    üî• Parameter Heatmap
                </button>
                <button class="tab-btn" onclick="UI.switchTab('ranges')">
                    üìä Range Analysis
                </button>
            </div>

            <!-- Tab Content Containers -->
            
            <!-- SENSITIVITY TAB -->
            <div id="tab-sensitivity" class="tab-content active">
                <div class="tab-header">
                    <h3>üå™Ô∏è Tornado Diagram: Which Parameters Matter Most?</h3>
                    <p>Shows how ¬±% change in each parameter affects LCOE. <strong>Wider bars = More impact</strong>. Ranked by sensitivity.</p>
                </div>

                <div class="sensitivity-controls">
                    <label>Variance (¬±%):</label>
                    <input type="number" id="tornado-variance" value="20" min="5" max="50" step="5" style="width: 80px;">
                    <button class="btn-primary" onclick="UI.updateTornadoChart()" style="width: auto; padding: 8px 16px;">üìä Generate Chart</button>
                </div>

                <div class="chart-wrapper">
                    <canvas id="chart-tornado"></canvas>
                </div>
            </div>

            <!-- HEATMAP TAB -->
            <div id="tab-heatmap" class="tab-content">
                <div class="tab-header">
                    <h3>üî• Dual Parameter Heatmap: Interactive Sensitivity</h3>
                    <p>Explore LCOE across two parameters simultaneously. <strong>Green = Low LCOE (better)</strong>, <strong>Red = High LCOE (worse)</strong>.</p>
                </div>

                <div class="heatmap-controls">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div class="input-group">
                            <label>First Parameter:</label>
                            <select id="heatmap-param1" onchange="UI.updateHeatmap()">
                                <option value="capex_per_mw">CAPEX per MW (‚Çπ)</option>
                                <option value="energy_generation">Annual Energy (MWh)</option>
                                <option value="discount_rate">Discount Rate (%)</option>
                                <option value="opex_percent">OPEX % of CAPEX</option>
                                <option value="interest_rate">Interest Rate (%)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Second Parameter:</label>
                            <select id="heatmap-param2" onchange="UI.updateHeatmap()">
                                <option value="discount_rate">Discount Rate (%)</option>
                                <option value="capex_per_mw">CAPEX per MW (‚Çπ)</option>
                                <option value="energy_generation">Annual Energy (MWh)</option>
                                <option value="opex_percent">OPEX % of CAPEX</option>
                                <option value="interest_rate">Interest Rate (%)</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-primary" onclick="UI.updateHeatmap()" style="width: 100%;">üî• Generate Heatmap</button>
                </div>

                <!-- Grid Heatmap Container -->
                <div id="heatmap-grid-container" style="margin-top: 20px;"></div>
            </div>

            <!-- RANGES TAB -->
            <div id="tab-ranges" class="tab-content">
                <div class="tab-header">
                    <h3>üìä Parameter Range Analysis</h3>
                    <p>See how LCOE changes across realistic parameter ranges. Understand the full sensitivity spectrum.</p>
                </div>

                <!-- <button class="btn-primary" onclick="UI.generateRangeAnalysis()" style="width: 100%; margin-bottom: 20px;">üìà Generate All Charts</button> -->

                <!-- Combined Parameters Chart -->
                <div class="chart-wrapper">
                    <h4 style="text-align: center; color: #333; margin-bottom: 15px;">üìà Parameter Sensitivity Comparison</h4>
                    <canvas id="chart-parameters-combo"></canvas>
                </div>

                <!-- Individual Parameter Charts -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-top: 30px;">
                    <div class="chart-wrapper">
                        <canvas id="chart-capex-range"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chart-energy-range"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chart-discount-range"></canvas>
                    </div>
                </div>

                <!-- Range Summary Table -->
                <div style="margin-top: 40px;">
                    <h4 style="color: #333; margin-bottom: 15px;">üìã Range Summary Table</h4>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">
                        Quick reference showing LCOE at minimum, current, and maximum for each parameter.
                    </p>
                    <div id="range-summary-container" style="overflow-x: auto; background: white; padding: 20px; border-radius: 8px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="calculator.js"></script>
    <script src="advanced-charts.js"></script>
    <script src="heatmap-alternatives.js"></script>
    <script src="range-charts.js"></script>
    <script src="ui.js"></script>
</body>
</html>